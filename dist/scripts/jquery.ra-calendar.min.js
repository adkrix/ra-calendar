/*! jquery.ra-calendar.js 2014-04-19 20:04 */
$(function(){"use strict";$.RaCalendar={version:"0.0.1",elements:{root:null,header:null,resources:null,content:null},config:{date:{begin_time:"09:00:00",duration:3600,round:"15m"},events:{id:"id",resource_id:"resource_id",title:"name",begin:"begin",end:"end",duration:"",url:"url"},resources:{id:"",title:"name"}},events:[],resorces:[],default_color:{color:"#000000",background:"#eeeeee"}},$.RaCalendar.methods={tmpl:function(a,b){return a.replace(/\{([\w\.]*)\}/g,function(a,c){var d,e,f,g;for(d=c.split("."),e=b[d.shift()],f=0,g=d.length;g>f;f++)c=d[f],e=e[c];return"undefined"!=typeof e&&null!==e?e:""})},normalizeEvent:function(a,b){var c,d;return c=this.base.config,d={id:a[c.events.id]?a[c.events.id]:b,resource_id:a[c.events.resource_id]?a[c.events.resource_id]:0,title:a[c.events.title],begin:this.date.round(a[c.events.begin],c.date.round),event:a,url:a[c.events.url]?a[c.events.url]:""},d.end=c.events.end&&a[c.events.end]?this.date.round(a[c.events.end],c.date.round):c.events.duration&&a[c.events.duration]?this.date.round(this.date.update(d.begin,a[c.events.duration]),c.date.round):c.date.duration?this.date.round(this.date.update(d.begin,c.date.duration),c.date.round):void 0,d},updateEvents:function(a){var b;return b=this,this.base.events=a?$.map(a,function(a,c){return b.normalizeEvent(a,c)}):[],console.log(this.base.events,a)},updateResources:function(a){return a}},$.RaCalendar.methods.date={isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},getDaysInMonth:function(a,b){var c;return[31,null!=(c=this.isLeapYear(a))?c:{29:28},31,30,31,30,31,31,30,31,30,31][b]},clone:function(a){return new Date(a.getTime())},parse:function(a){return new Date(Date.parse(a))},format:function(a,b){return DateFormat.format.date(a,b)},reformat:function(a,b){return this.format(this.parseDate(a),b)},normalize:function(a){return a?"number"==typeof a?new Date(a):"object"==typeof a?this.clone(a):this.parse(a):$.now()},round:function(a,b){return b=function(){switch(b){case"1m":return 6e4;case"5m":return 3e5;case"10m":return 6e5;case"15m":return 9e5;case"30m":return 18e5;default:return 6e4}}(),new Date(Math.floor(new Date(a).getTime()/b)*b)},update:function(a,b){return this.normalize(a).setSeconds(b)}},$.RaCalendar.template={header:{main:"<div class='ra-header'>header</div>"},resources:{main:"<div class='ra-resources'>resources</div>"},content:{main:"<div class='ra-content'>content</div>"},ul:"<ul>{list}</ul>",li_link:"<li><a href='{url}'>{title}</a></li>",li_div:"<li><div>{title}</div> </li>"},$.fn.RaCalendar=function(a){return $(this).each(function(){var b,c,d,e,f,g;return b=$.extend(!0,{},$.RaCalendar),d=b.elements,d.root=$(this).empty(),c=b.config,a.config&&$.extend(!0,c,a.config),f=b.template,a.template&&$.extend(!0,f,a.template),e=b.methods,b.methods.base=b,a.parseDate&&(e.date.parse=a.parseDate),a.formatDate&&(e.date.format=a.formatDate),b.date=e.date.normalize(a.date),e.updateEvents(a.events),e.updateResources(a.resources),d.header=$(f.header.main).appendTo(d.root),d.resources=$(f.resources.main).appendTo(d.root),d.content=$(f.content.main).appendTo(d.root),g="",$.each(b.events,function(a,b){return g+=b.url?e.tmpl(f.li_link,b):e.tmpl(f.li_div,b)}),d.content.html(e.tmpl(f.ul,{list:g}))})}});